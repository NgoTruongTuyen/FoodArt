<div class="grid grid-cols-1 md:grid-cols-4 gap-2 mx-2">
  <div class="col-span-3">
    <h1 class="text-2xl font-bold">Edit Dish</h1>

    {{!-- Input to edit dish --}}

    <form action="/dishes/{{dish.slug}}/edit" method="POST">
      <input type="hidden" name="_csrf" value="{{ @root/_csrfToken }}">
      <input type="hidden" name="_method" value="PUT">
      {{!-- Dish title --}}
      <div class="mb-4">
        <label for="title" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Title
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="title" type="text" name="title" value="{{dish.title}}" />
      </div>

      {{!-- Dish description --}}
      <div class="mb-4">
        <label for="description" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Description
        </label>
        <textarea
          class="resize shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="description" name="description">{{dish.description}}</textarea>
      </div>

      {{!-- Dish image --}}
      <div class="mb-4">
        <label for="image" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Image
        </label>

        <div class="p-2 shadow-md">
          <div class="image-preview-single">
            <img src="" alt=""
              class="w-full h-full max-h-[calc(80vh)] object-cover object-top z-[-1] inset-0 fixed opacityIncrease" />
            <input type="hidden" role="uploadcare-uploader" name="image" value="{{dish.image}}" data-clearable
              data-images-only />
          </div>
        </div>
      </div>

      {{!-- Dish trailer --}}
      <div class="mb-4">
        <label for="trailer" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Trailer
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="trailer" type="text" name="trailer" value="{{dish.trailer}}" />
      </div>

      {{!-- Dish time --}}
      <div class="mb-4">
        <label for="time" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Time
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="time" type="text" name="time" value="{{dish.time}}" />
      </div>

      {{!-- Dish premiere --}}
      <div class="mb-4">
        <label for="premiere" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Premiere
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="premiere" type="text" name="premiere" value="{{dish.premiere}}" />
      </div>

      {{!-- Dish releaseyear --}}
      <div class="mb-4">
        <label for="releaseyear" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Release year
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="releaseyear" type="text" name="releaseYear" value="{{dish.releaseYear}}" />
      </div>

      {{!-- Dish rating --}}
      <div class="mb-4">
        <label for="rating" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Rating
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="rating" type="text" name="rating" value="{{dish.rating}}" />
      </div>

      {{!-- Dish imdbId --}}
      <div class="mb-4">
        <label for="imdbId" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          ImdbId
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="imdbId" type="text" name="imdbId" value="{{dish.imdbId}}" />
      </div>

      {{!-- Dish englishTitle --}}
      <div class="mb-4">
        <label for="englishTitle" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          EnglishTitle
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
          id="englishTile" type="text" name="englishTitle" value="{{dish.englishTitle}}" />
      </div>

      <div class="mb-4">
        <label for="englishTitle" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
          Chọn chuyên mục
        </label>
        <select id="categorySelect" class="shadow appearance-none border rounded w-full text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline
        " name="categories[]" multiple>
          {{#each categories}}
          <option class="p-2" value="{{this._id}}">
            {{this.title}}
          </option>
          {{/each}}
        </select>
      </div>

      <div class="mb-4">
        <button type="submit"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
          Update
        </button>
      </div>


    </form>


  </div>
  <div class="shadow-md place-self-start p-2">
    <h3 class="text-lg text-opacity-60 font-bold mb-2">Thẻ lớn</h3>

    <div class="h-96">
      {{> card image=dish.image title=dish.title englishTitle=dish.englishTitle slug=dish.slug }}
    </div>

    <h3 class="text-lg text-opacity-60 font-bold mt-4 mb-2">Thẻ nhỏ</h3>

    <div class="h-28">
      {{> card image=dish.image title=dish.title englishTitle=dish.englishTitle slug=dish.slug }}
    </div>

    {{!-- Thêm season --}}

    <h3 class="text-lg text-opacity-60 font-bold mt-4 mb-2">Thêm season</h3>
    <ul class="divide-y">
      {{#each dish.seasons}}
      <li class="flex justify-between gap-1">
        <a class="p-2 bg-gray-100 dark:bg-gray-600 dark:hover:bg-gray-500 hover:bg-gray-200 flex-grow"
          href="./season/{{slug}}">
          {{name}}
          {{!-- delete season --}}
        </a>
        <button
          class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline"
          onclick="deleteSeason('{{this.slug}}')">
          <i class="fas fa-trash-alt"></i>
        </button>
      </li>
      {{/each}}

      <div class="">
        <form action="/season" method="POST" class="flex gap-1">
          <input type="hidden" name="dish" value={{@root/dish._id}}>
          <label for="title" class="block text-base-content text-opacity-60 text-sm font-bold mb-2">
            Season mới
          </label>
          <input
            class="shadow appearance-none border rounded w-full py-2 px-3 text-black text-opacity-60 leading-tight focus:outline-none focus:shadow-outline"
            id="title" type="text" name="name" value="" />
          <input type="hidden" name="_csrf" value="{{@root/_csrfToken}}">
          <button class="btn btn-primary mt-2">Tạo season</button>
        </form>
      </div>
    </ul>
  </div>
</div>

<style>
  .opacityIncrease {
    /* animation keep last state */
    animation: opacityIncrease 2s linear forwards;
  }

  @keyframes opacityIncrease {
    0% {
      opacity: 0;
    }

    100% {
      opacity: 0.6;
    }
  }
</style>

<script>
  const categoriesId = "{{dish.categories}}".split(',');

  $("#categorySelect").val(categoriesId)

  function deleteSeason(seasonSlug) {
    if (confirm("Bạn có chắc chắn muốn xóa?")) {
      $.ajax({
        url: `/season/{{dish.slug}}/${seasonSlug}`,
        data: {
          _csrf: "{{@root/_csrfToken}}"

        },
        type: 'DELETE',
        success: function (result) {
          location.reload();
        }
      });
    }
  }
  $("textarea").each(function () {
    this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
  }).on("input", function () {
    this.style.height = "auto";
    this.style.height = (this.scrollHeight) + "px";
  });


</script>

<script>
  CKEDITOR.replace('description')
</script>